<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to unpivotr • unpivotr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to unpivotr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">unpivotr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/html.html">HTML Tables</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to unpivotr</a></li>
    <li><a class="dropdown-item" href="../articles/small-multiples.html">Small Multiples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nacnudus/unpivotr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to unpivotr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nacnudus/unpivotr/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h2>
<p>This is based on a talk. You might want to watch the video or read
the <a href="https://docs.google.com/presentation/d/1tVwn_-QVGZTflnF9APiPACNvyAKqujdl6JmxmrdDjok" class="external-link">slides</a>
(see speaker notes by clicking the cog):</p>
<p><a href="https://docs.google.com/presentation/d/1tVwn_-QVGZTflnF9APiPACNvyAKqujdl6JmxmrdDjok" class="external-link uri">https://docs.google.com/presentation/d/1tVwn_-QVGZTflnF9APiPACNvyAKqujdl6JmxmrdDjok</a></p>
</div>
<div class="section level2">
<h2 id="reading-easy-spreadsheets-with-readxl">1. Reading easy spreadsheets with {readxl}<a class="anchor" aria-label="anchor" href="#reading-easy-spreadsheets-with-readxl"></a>
</h2>
<p>It is easy to read a spreadsheet into R when it has:</p>
<ul>
<li>A rectangular shape</li>
<li>One row of column headers</li>
<li>No meaningful colour or other formatting</li>
<li>Consistent data types in each column, e.g. all numbers or all
text</li>
</ul>
<p>Here is an example, a dataset of student test marks in different
subjects.</p>
<p><img src="images%2Fhp-tidy.png"><!-- --></p>
<p>To test whether a table will be easy to import, ask yourself “Is
every row self-sufficient? Could I read only one row and understand all
the data in it?” In this case, one row will tell you that Ron got two
marks in potions in his second year.</p>
<p>Because this table is simple – or ‘tidy’ – it is easily imported into
a data frame, using the {readxl} package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span> <span class="co"># for read_excel()</span></span>
<span></span>
<span><span class="va">hp_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/harry-potter.xlsx"</span>, package <span class="op">=</span> <span class="st">"unpivotr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">hp_xlsx</span>, sheet <span class="op">=</span> <span class="st">"tidy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   Pupil Year     Subject    Mark</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Ron   1st year Potions       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Ron   1st year Herbology     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Ron   2nd year Potions       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ron   2nd year Herbology    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Ginny 1st year Potions       8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Ginny 1st year Herbology     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Ginny 2nd year Potions       9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Ginny 2nd year Herbology     7</span></span></code></pre></div>
<p>Note that the row of column names in the spreadsheet has been used as
column names of the data frame. Also the data type of each column is
either <code>dbl</code> (double, which means a number), or
<code>chr</code> (character) as appropriate.</p>
</div>
<div class="section level2">
<h2 id="trying-to-read-a-hard-spreadsheet-with-readxl">2. Trying to read a hard spreadsheet with {readxl}<a class="anchor" aria-label="anchor" href="#trying-to-read-a-hard-spreadsheet-with-readxl"></a>
</h2>
<p>Here’s is the same data but this time it is in a spreadsheet that the
{readxl} package can’t read so easily. Why not?</p>
<p><img src="images%2Fhp-untidy.png"><!-- --></p>
<p>The <code>Pupil</code> and <code>Year</code> columns have been
combined into one, so the names of the pupils aren’t in the same rows as
their marks, nor are they in the same columns. There is also a text
value <code>"10 - really?"</code> amongst a column of numbers.</p>
<p>Is every row self-sufficient? Could you read only one row and
understand all the data in it? No, because one row will only tell you
the mark, subject and year, but not the name. Or else it will tell you
the name, but not the mark, subject or year.</p>
<p>Here is what happens when the table is read with the {readxl}
package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">untidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">hp_xlsx</span>, sheet <span class="op">=</span> <span class="st">"untidy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span></span>
<span><span class="va">untidy</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   ...1     Potions Herbology   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Ron           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1st year       3 7           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2nd year       2 10 - really?</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ginny         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1st year       8 9           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2nd year       9 7</span></span></code></pre></div>
<p>What has gone wrong? The spreadsheet has broken the assumptions that
the {readxl} package makes about data.</p>
<ul>
<li>A rectangular shape. The spreadsheet is not rectangular because the
top-left cell is deliberately blank (is not ‘missing’ data), and so are
the cells to the right of <code>"Ron"</code> and
<code>"Ginny"</code>.</li>
<li>No meaningful colour or other formatting. The spreadsheet has
meaningful formatting to distinguish between names in bold
(<code>"Ron"</code>, <code>"Ginny"</code>) and years in plain type,
(<code>"1st year"</code>, <code>"2nd year"</code>).</li>
<li>Consistent data types in each column. The spreadsheet has mixed data
types in the Herbology column, where some cells are numbers and one is
text: <code>"10 -   really?"</code>.</li>
</ul>
<p>The <code>readxl</code> package has done its best with a difficult
file.</p>
<ul>
<li>It has dealt with the non-rectangular shape by filling the gaps,
using <code>...1</code> to fill the cell in the top-left corner with a
column header, and <code>NA</code> to fill the cells to the right of
<code>Ron</code> and <code>Ginny</code>.</li>
<li>It has dealt with the mixed data types in the Herbology column by
treating everything as text, even the numbers, so that it can
accommodate the text value <code>"10 - really?"</code>.</li>
<li>It hasn’t dealt with the meaningful formatting (bold names) because
it is blind to formatting – {readxl} doesn’t know anything about
formatting except for data types.</li>
</ul>
<p>Unfortunately {readxl} hasn’t been able to make the data tidy. Each
row still isn’t self-sufficient. You couldn’t read only one row and
understand all the data in it.</p>
<p>Here is a final example of a spreadsheet that breaks the one
remaining assumption: that there is a single row of column headers. This
file has two rows of column headers.</p>
<p><img src="images%2Fhp-pivoted.png"><!-- --></p>
<p>The rest of this tutorial will demonstrate how to use the {tidyxl}
and {unpivotr} packages to import that spreadsheet.</p>
</div>
<div class="section level2">
<h2 id="demonstration-of-tidyxl-and-unpivotr">3. Demonstration of {tidyxl} and {unpivotr}<a class="anchor" aria-label="anchor" href="#demonstration-of-tidyxl-and-unpivotr"></a>
</h2>
<p>Don’t expect to understand yet how the following code works. It is
here to show you what to expect later, and it is the entire code to
import the spreadsheet above.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/unpivotr" class="external-link">unpivotr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'unpivotr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:tidyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     pack, unpack</span></span>
<span></span>
<span><span class="va">hp_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/harry-potter.xlsx"</span>, package <span class="op">=</span> <span class="st">"unpivotr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">xlsx_cells</a></span><span class="op">(</span><span class="va">hp_xlsx</span>, sheets <span class="op">=</span> <span class="st">"pivoted"</span><span class="op">)</span></span>
<span><span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_formats.html" class="external-link">xlsx_formats</a></span><span class="op">(</span><span class="va">hp_xlsx</span><span class="op">)</span></span>
<span></span>
<span><span class="va">indent</span> <span class="op">&lt;-</span> <span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">alignment</span><span class="op">$</span><span class="va">indent</span></span>
<span></span>
<span><span class="va">tidied</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead_if</a></span><span class="op">(</span><span class="va">indent</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"left-up"</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"subject"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">address</span>, <span class="va">dormitory</span>, <span class="va">name</span>, <span class="va">location</span>, <span class="va">subject</span>, mark <span class="op">=</span> <span class="va">numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">dormitory</span>, <span class="va">name</span>, <span class="va">location</span>, <span class="va">subject</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidied</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 6</span></span></span>
<span><span class="co">#&gt;    address dormitory name     location subject                    mark</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> C4      Witch     Ginny    Castle   Charms                        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> C5      Witch     Ginny    Castle   Potions                       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> C3      Witch     Ginny    Castle   <span style="color: #BB0000;">NA</span>                           11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> C8      Witch     Ginny    Grounds  Care of Magical Creatures     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> C7      Witch     Ginny    Grounds  Herbology                     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> C6      Witch     Ginny    Grounds  <span style="color: #BB0000;">NA</span>                            8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> B4      Witch     Hermione Castle   Charms                        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> B5      Witch     Hermione Castle   Potions                       9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> B3      Witch     Hermione Castle   <span style="color: #BB0000;">NA</span>                           11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> B8      Witch     Hermione Grounds  Care of Magical Creatures     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> B7      Witch     Hermione Grounds  Herbology                     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> B6      Witch     Hermione Grounds  <span style="color: #BB0000;">NA</span>                            7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> D4      Wizard    Harry    Castle   Charms                        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> D5      Wizard    Harry    Castle   Potions                       7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> D3      Wizard    Harry    Castle   <span style="color: #BB0000;">NA</span>                            7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> D8      Wizard    Harry    Grounds  Care of Magical Creatures     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> D7      Wizard    Harry    Grounds  Herbology                     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> D6      Wizard    Harry    Grounds  <span style="color: #BB0000;">NA</span>                           11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> E4      Wizard    Ron      Castle   Charms                        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> E5      Wizard    Ron      Castle   Potions                       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span> E3      Wizard    Ron      Castle   <span style="color: #BB0000;">NA</span>                            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span> E8      Wizard    Ron      Grounds  Care of Magical Creatures     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span> E7      Wizard    Ron      Grounds  Herbology                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span> E6      Wizard    Ron      Grounds  <span style="color: #BB0000;">NA</span>                            3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="explanation-of-tidyxlxlsx_cells">4. Explanation of tidyxl::xlsx_cells()<a class="anchor" aria-label="anchor" href="#explanation-of-tidyxlxlsx_cells"></a>
</h2>
<p>The first step to import a difficult spreadsheet is to read it with
<code><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">tidyxl::xlsx_cells()</a></code>.</p>
<p>What does <code><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">tidyxl::xlsx_cells()</a></code> do that is different from
<code><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">readxl::read_excel()</a></code>? Instead of returning the
<em>data</em> in a data frame, it returns <em>individual cells</em> in a
data frame. Try matching each row of the output of
<code><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">xlsx_cells()</a></code> to a cell in the spreadsheet.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">xlsx_cells</a></span><span class="op">(</span><span class="va">hp_xlsx</span>, sheets <span class="op">=</span> <span class="st">"pivoted"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Drop some columns to make it clearer what is going on</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span>, <span class="va">is_blank</span>, <span class="va">data_type</span>, <span class="va">character</span>, <span class="va">numeric</span>, <span class="va">local_format_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 47 × 7</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character              numeric local_format_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1     2 FALSE    character Witch                       <span style="color: #BB0000;">NA</span>               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1     4 FALSE    character Wizard                      <span style="color: #BB0000;">NA</span>               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2     1 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>               9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2     2 FALSE    character Hermione                    <span style="color: #BB0000;">NA</span>               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2     3 FALSE    character Ginny                       <span style="color: #BB0000;">NA</span>               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2     4 FALSE    character Harry                       <span style="color: #BB0000;">NA</span>               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     2     5 FALSE    character Ron                         <span style="color: #BB0000;">NA</span>               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3     1 FALSE    character Castle                      <span style="color: #BB0000;">NA</span>              12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                          11               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                          11               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     4     1 FALSE    character Charms                      <span style="color: #BB0000;">NA</span>              10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           6               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           0               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           0               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     5     1 FALSE    character Potions                     <span style="color: #BB0000;">NA</span>              11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           9               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           5               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     6     1 FALSE    character Grounds                     <span style="color: #BB0000;">NA</span>              12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           8               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                          11               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           3               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     7     1 FALSE    character Herbology                   <span style="color: #BB0000;">NA</span>              10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">29</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           5               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">30</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           1               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">31</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           8               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">32</span>     7     5 FALSE    character 10 - really?                <span style="color: #BB0000;">NA</span>              13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">33</span>     8     1 FALSE    character Care of Magical Creat…      <span style="color: #BB0000;">NA</span>              14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">34</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">35</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7              17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">36</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           3              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">37</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           3              16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">38</span>     9     1 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">39</span>     9     2 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">40</span>     9     3 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">41</span>     9     4 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">42</span>     9     5 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">43</span>    10     1 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">44</span>    10     2 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">45</span>    10     3 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">46</span>    10     4 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">47</span>    10     5 TRUE     blank     <span style="color: #BB0000;">NA</span>                          <span style="color: #BB0000;">NA</span>              16</span></span></code></pre></div>
<p>The first row of the output describes the cell B2 (row 1, column 2)
of the spreadsheet, with the character value <code>"Witch"</code>.</p>
<pre><code># A tibble: 47 x 7
     row   col is_blank data_type character numeric local_format_id
   &lt;int&gt; &lt;int&gt; &lt;lgl&gt;    &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;           &lt;int&gt;
 1     1     2 FALSE    character Witch          NA               2</code></pre>
<p>Row 10 describes the cell C3 (row 3, column 3) of the spreadsheet,
with the numeric value <code>11</code>.</p>
<p>So what <code><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">xlsx_cells()</a></code> has done is give you a data frame
that isn’t data itself, but it <em>describes</em> the data in the
spreadsheet. Each row describes one cell. This allows you to do some
fancy tricks, like filter for all the numeric cells.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">data_type</span> <span class="op">==</span> <span class="st">"numeric"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 23 × 7</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character numeric local_format_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>             11               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>             11               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>              7               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>              2               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>              2               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>              6               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>              0               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>              0               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>              9               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>              5               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>              7               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>              2               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>              7               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>              8               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>             11               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>              3               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>              5               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>              1               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>              8               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>              2              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>              7              17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>              3              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>              3              16</span></span></code></pre></div>
<p>Or you could filter for a particular cell by its row and column
position.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">row</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">col</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;     row   col is_blank data_type character numeric local_format_id</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     2     4 FALSE    character Harry          <span style="color: #BB0000;">NA</span>               3</span></span></code></pre></div>
<p>And you can filter out all ‘blank’ cells. A cell is ‘blank’ if it has
formatting but no value. Sometimes it’s useful to have these, but
usually you should discard them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 36 × 7</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character              numeric local_format_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1     2 FALSE    character Witch                       <span style="color: #BB0000;">NA</span>               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1     4 FALSE    character Wizard                      <span style="color: #BB0000;">NA</span>               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2     2 FALSE    character Hermione                    <span style="color: #BB0000;">NA</span>               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2     3 FALSE    character Ginny                       <span style="color: #BB0000;">NA</span>               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2     4 FALSE    character Harry                       <span style="color: #BB0000;">NA</span>               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2     5 FALSE    character Ron                         <span style="color: #BB0000;">NA</span>               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3     1 FALSE    character Castle                      <span style="color: #BB0000;">NA</span>              12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                          11               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                          11               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     4     1 FALSE    character Charms                      <span style="color: #BB0000;">NA</span>              10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           6               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           0               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           0               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     5     1 FALSE    character Potions                     <span style="color: #BB0000;">NA</span>              11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           9               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           5               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7               3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     6     1 FALSE    character Grounds                     <span style="color: #BB0000;">NA</span>              12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           8               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                          11               5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           3               6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     7     1 FALSE    character Herbology                   <span style="color: #BB0000;">NA</span>              10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           5               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">29</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           1               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">30</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           8               2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">31</span>     7     5 FALSE    character 10 - really?                <span style="color: #BB0000;">NA</span>              13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">32</span>     8     1 FALSE    character Care of Magical Creat…      <span style="color: #BB0000;">NA</span>              14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">33</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           2              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">34</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           7              17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">35</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           3              15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">36</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                           3              16</span></span></code></pre></div>
<p>That is all you need to know about the tidyxl package for now. Later
you will be shown how to filter for cells by their formatting (e.g. bold
cells, indented cells, or cells with coloured text).</p>
</div>
<div class="section level2">
<h2 id="explanation-of-unpivotrbehead">5. Explanation of unpivotr::behead()<a class="anchor" aria-label="anchor" href="#explanation-of-unpivotrbehead"></a>
</h2>
<p>You’ve seen that <code><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">tidyxl::xlsx_cells()</a></code> reads a
spreadsheet one cell at a time, so that you can filter for particular
cells by their position, their value, their data type, etc. You could
now write code to tidy up any spreadsheet.</p>
<p>The unpivotr package gives you some pre-packaged tools for tidying up
a spreadsheet. The most important tool is <code><a href="../reference/behead.html">behead()</a></code>, which
deals with one layer of header cells at a time.</p>
<p>Let’s look again at the original spreadsheet. I have highlighted the
first row of header cells.</p>
<p><img src="images%2Funtidy-header-row-1.png"><!-- --></p>
<p>Use <code><a href="../reference/behead.html">unpivotr::behead()</a></code> to tag data cells with
<code>"Witch"</code> or <code>"Wizard"</code>, and then strip (or
behead!) those header cells from the rest – they are no longer
required.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 34 × 8</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character    numeric local_format_id dormitory</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     2     2 FALSE    character Hermione          <span style="color: #BB0000;">NA</span>               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2     3 FALSE    character Ginny             <span style="color: #BB0000;">NA</span>               4 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 6               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 9               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               4 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 1               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2              15 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7              17 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     2     4 FALSE    character Harry             <span style="color: #BB0000;">NA</span>               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     2     5 FALSE    character Ron               <span style="color: #BB0000;">NA</span>               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     7     5 FALSE    character 10 - really?      <span style="color: #BB0000;">NA</span>              13 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              15 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              16 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">29</span>     3     1 FALSE    character Castle            <span style="color: #BB0000;">NA</span>              12 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">30</span>     4     1 FALSE    character Charms            <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">31</span>     5     1 FALSE    character Potions           <span style="color: #BB0000;">NA</span>              11 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">32</span>     6     1 FALSE    character Grounds           <span style="color: #BB0000;">NA</span>              12 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">33</span>     7     1 FALSE    character Herbology         <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">34</span>     8     1 FALSE    character Care of Mag…      <span style="color: #BB0000;">NA</span>              14 <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Click through table to check that every cell belonging to the Witch
header has been taggged <code>"Witch"</code> in the column
<code>dormitory</code>, and the same for wizards Notice that the
locations <code>Castle</code> and <code>Grounds</code> have also been
tagged witch or wizard. Also, all the cells in row 1 have disappeared –
they have become values in the <code>dormitory</code> column.</p>
<p>What do the arguments to <code>behead("up-left", "dormitory")</code>
mean? The second one, <code>"dormitory"</code> becomes the column name
of the male/female tags. But the direction <code>"up-left"</code> is the
most important one. It tells <code><a href="../reference/behead.html">behead()</a></code> which way to look for
a header cell.</p>
<p>For example, starting from the cell C3 (row 3 column 3),
<code><a href="../reference/behead.html">behead()</a></code> looks up and to the left to find the header
<code>"Witch"</code>. Starting from the cell D4 (row 4, column 4) it
finds the header <code>"Wizard"</code>. Starting from cells in the first
column, there is no header cell in the <code>"up-left"</code> direction,
so they are tagged with missing values. Don’t worry about them – they
will come right later.</p>
<p>What if we try a different direction instead, <code>"up-right"</code>
(up and to the right)? Again, compare the table with the spreadsheet</p>
<p><img src="images%2Funtidy-header-row-1.png"><!-- --></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-right"</span>, <span class="st">"dormitory"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 34 × 8</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character    numeric local_format_id dormitory</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     2     2 FALSE    character Hermione          <span style="color: #BB0000;">NA</span>               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     3     1 FALSE    character Castle            <span style="color: #BB0000;">NA</span>              12 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4     1 FALSE    character Charms            <span style="color: #BB0000;">NA</span>              10 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5     1 FALSE    character Potions           <span style="color: #BB0000;">NA</span>              11 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 9               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     6     1 FALSE    character Grounds           <span style="color: #BB0000;">NA</span>              12 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     7     1 FALSE    character Herbology         <span style="color: #BB0000;">NA</span>              10 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     8     1 FALSE    character Care of Mag…      <span style="color: #BB0000;">NA</span>              14 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2              15 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     2     3 FALSE    character Ginny             <span style="color: #BB0000;">NA</span>               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     2     4 FALSE    character Harry             <span style="color: #BB0000;">NA</span>               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 6               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 1               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7              17 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              15 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     2     5 FALSE    character Ron               <span style="color: #BB0000;">NA</span>               4 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">29</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               6 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">30</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               1 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">31</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               4 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">32</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3               6 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">33</span>     7     5 FALSE    character 10 - really?      <span style="color: #BB0000;">NA</span>              13 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">34</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              16 <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Check that Ginny has been tagged <code>"Wizard"</code>, and so have
her marks in cells below. Unpivotr doesn’t know that this is wrong, it
has just done what it was told. The <code><a href="../reference/behead.html">behead()</a></code> function isn’t
magic, it just enables you to tell unpivotr which data cells relate to
which header cells.</p>
</div>
<div class="section level2">
<h2 id="continuing-unpivotrbehead">6. Continuing <code>unpivotr::behead()</code><a class="anchor" aria-label="anchor" href="#continuing-unpivotrbehead"></a>
</h2>
<p>Let’s carry on with the second row of header cells (highlighted).
This time the direction is simply <code>"up"</code> for directly up
because there is a header in every column. Notice that we’re building up
a pipeline of transformations, one set of headers at a time.</p>
<p><img src="images%2Funtidy-header-row-2.png"><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 9</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character    numeric local_format_id dormitory</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 6               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 9               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               4 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 1               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2              15 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7              17 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     7     5 FALSE    character 10 - really?      <span style="color: #BB0000;">NA</span>              13 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              15 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              16 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     3     1 FALSE    character Castle            <span style="color: #BB0000;">NA</span>              12 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     4     1 FALSE    character Charms            <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     5     1 FALSE    character Potions           <span style="color: #BB0000;">NA</span>              11 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     6     1 FALSE    character Grounds           <span style="color: #BB0000;">NA</span>              12 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">29</span>     7     1 FALSE    character Herbology         <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">30</span>     8     1 FALSE    character Care of Mag…      <span style="color: #BB0000;">NA</span>              14 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: name &lt;chr&gt;</span></span></span></code></pre></div>
<p>Click through the table to match it to the spreadsheet. The header
cells in rows 1 and 2 have all disappeared to become values in the
<code>dormitory</code> and <code>name</code> columns. The cell C3 (row
3, column 3) has been tagged <code>"Witch"</code> and
<code>"Ginny"</code></p>
</div>
<div class="section level2">
<h2 id="handling-meaningful-formatting-with-unpivotrbehead_if">7. Handling meaningful formatting with
<code>unpivotr::behead_if()</code><a class="anchor" aria-label="anchor" href="#handling-meaningful-formatting-with-unpivotrbehead_if"></a>
</h2>
<p>Applying the same procedure to the headers in column A, which
describe the location and subject, what are the directions?</p>
<p>Starting from a data cell, say, B7 (row 7, column 2), the location
is<code>"Grounds"</code>, which is to the left and then up,
<code>"left-up"</code>.</p>
<p><img src="images%2Funtidy-header-col-1.png"><!-- --></p>
<p>But there is a complication. When <code><a href="../reference/behead.html">unpivotr::behead()</a></code> is
travelling up the cells in column 1, how does it know to stop at
<code>"Grounds"</code> and not overshoot to <code>"Potions"</code> or
any of the cells further up? You must tell <code><a href="../reference/behead.html">behead()</a></code> to stop
at the first cell that isn’t indented. Alternatively, you could tell it
to stop at the first cell that is bold.</p>
<p>Use <code><a href="../reference/behead.html">unpivotr::behead_if()</a></code> when there is a rule to
identify a header cell. In this case the rule will be “when the cell has
bold formatting”.</p>
<p>A spreadsheet cell can have so many different formats that it would
be unweildy for {tidyxl} to import them all at once. Instead, {tidyxl}
imports a kind of lookup table of formatting, and each cell has a key
into the lookup table, called <code>local_format_id</code>.</p>
<p>Here’s how to look up the <code>indented</code> property of a
cell.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_formats.html" class="external-link">xlsx_formats</a></span><span class="op">(</span><span class="va">hp_xlsx</span><span class="op">)</span> <span class="co"># load the format lookup table from the file</span></span>
<span></span>
<span><span class="va">indent</span> <span class="op">&lt;-</span> <span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">alignment</span><span class="op">$</span><span class="va">indent</span> <span class="co"># find the 'indent' property</span></span>
<span></span>
<span><span class="va">indent</span><span class="op">[</span><span class="va">cells</span><span class="op">$</span><span class="va">local_format_id</span><span class="op">]</span> <span class="co"># look up the indent property of each cell</span></span>
<span><span class="co">#&gt;  [1] 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1</span></span>
<span><span class="co">#&gt; [39] 0 0 0 0 1 0 0 0 0</span></span></code></pre></div>
<p>When you look up a format from inside <code><a href="../reference/behead.html">behead_if()</a></code>, you
don’t need to mention <code>cell$</code>, but you do have to name the
other arguments to <code><a href="../reference/behead.html">behead()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_formats.html" class="external-link">xlsx_formats</a></span><span class="op">(</span><span class="va">hp_xlsx</span><span class="op">)</span> <span class="co"># load the format lookup table from the file</span></span>
<span><span class="va">indent</span> <span class="op">&lt;-</span> <span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">alignment</span><span class="op">$</span><span class="va">indent</span> <span class="co"># find the 'indent' property</span></span>
<span></span>
<span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead_if</a></span><span class="op">(</span><span class="va">indent</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"left-up"</span>, <span class="co"># This argument has to be named now.</span></span>
<span>            name <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span>     <span class="co"># So does this one.</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 28 × 10</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character    numeric local_format_id dormitory</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 6               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 9               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               4 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     4     1 FALSE    character Charms            <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     5     1 FALSE    character Potions           <span style="color: #BB0000;">NA</span>              11 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 1               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2              15 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7              17 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     7     5 FALSE    character 10 - really?      <span style="color: #BB0000;">NA</span>              13 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              15 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              16 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     7     1 FALSE    character Herbology         <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     8     1 FALSE    character Care of Mag…      <span style="color: #BB0000;">NA</span>              14 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: name &lt;chr&gt;, location &lt;chr&gt;</span></span></span></code></pre></div>
<p>You can give more than one rule to <code><a href="../reference/behead.html">behead_if()</a></code> at once.
They are applied together, so all the rules must evaluate to
<code>TRUE</code> for a cell to be treated as a header cell. Here’s an
example applying the additional rule that a cell must be bold. The
result in this case is the same.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_formats.html" class="external-link">xlsx_formats</a></span><span class="op">(</span><span class="va">hp_xlsx</span><span class="op">)</span></span>
<span><span class="va">indent</span> <span class="op">&lt;-</span> <span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">alignment</span><span class="op">$</span><span class="va">indent</span></span>
<span><span class="va">bold</span> <span class="op">&lt;-</span> <span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">font</span><span class="op">$</span><span class="va">bold</span> <span class="co"># find the 'bold' property</span></span>
<span></span>
<span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead_if</a></span><span class="op">(</span><span class="va">indent</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>, <span class="co"># First rule</span></span>
<span>            <span class="va">bold</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span>,        <span class="co"># Second rule. Both must be TRUE</span></span>
<span>            direction <span class="op">=</span> <span class="st">"left-up"</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 28 × 10</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character    numeric local_format_id dormitory</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 6               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 9               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               4 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     4     1 FALSE    character Charms            <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     5     1 FALSE    character Potions           <span style="color: #BB0000;">NA</span>              11 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 1               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2              15 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7              17 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     7     5 FALSE    character 10 - really?      <span style="color: #BB0000;">NA</span>              13 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              15 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">26</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              16 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">27</span>     7     1 FALSE    character Herbology         <span style="color: #BB0000;">NA</span>              10 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">28</span>     8     1 FALSE    character Care of Mag…      <span style="color: #BB0000;">NA</span>              14 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: name &lt;chr&gt;, location &lt;chr&gt;</span></span></span></code></pre></div>
<p>Check that Hermione got 5 marks in a subject taken in Hogwarts
grounds, by looking at cell B7 (row 7, column 2).</p>
</div>
<div class="section level2">
<h2 id="finishing-and-cleaning-up">8. Finishing and cleaning up<a class="anchor" aria-label="anchor" href="#finishing-and-cleaning-up"></a>
</h2>
<p>Only one layer of headers remains: the subjects in column 1. The
direction is directly <code>"left"</code>.</p>
<p><img src="images%2Funtidy-header-col-2.png"><!-- --></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead_if</a></span><span class="op">(</span><span class="va">indent</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"left-up"</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"subject"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 11</span></span></span>
<span><span class="co">#&gt;      row   col is_blank data_type character    numeric local_format_id dormitory</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     3     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     3     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     4     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 6               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 9               3 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               4 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     3     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     4     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 0               1 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     5     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               3 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     5     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2               4 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     6     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7               5 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>     6     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               6 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>     7     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 5               2 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>     7     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 1               1 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>     8     2 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 2              15 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>     8     3 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 7              17 Witch    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>     6     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                11               5 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span>     6     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3               6 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span>     7     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 8               2 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span>     7     5 FALSE    character 10 - really?      <span style="color: #BB0000;">NA</span>              13 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span>     8     4 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              15 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span>     8     5 FALSE    numeric   <span style="color: #BB0000;">NA</span>                 3              16 Wizard   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: name &lt;chr&gt;, location &lt;chr&gt;, subject &lt;chr&gt;</span></span></span></code></pre></div>
<p>Check that Hermione got 5 marks in Herbology in particular, taken in
Hogwarts grounds, by looking at cell B7 (row 7, column 2).</p>
<p>The final cleanup is straightforward; choose the columns to keep,
using the standard tidyverse function <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code>. At
the same time you can rename the column <code>numeric</code> to
<code>mark</code>, and the column <code>character</code> to
<code>other</code>. What is the column <code>other</code> for? For the
value <code>"10 - really?"</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead_if</a></span><span class="op">(</span><span class="va">indent</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"left-up"</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"subject"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dormitory</span>, <span class="va">name</span>, <span class="va">location</span>, <span class="va">subject</span>, mark <span class="op">=</span> <span class="va">numeric</span>, other <span class="op">=</span> <span class="va">character</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 6</span></span></span>
<span><span class="co">#&gt;    dormitory name     location subject                    mark other       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Witch     Hermione Castle   <span style="color: #BB0000;">NA</span>                           11 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Witch     Ginny    Castle   <span style="color: #BB0000;">NA</span>                           11 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Witch     Hermione Castle   Charms                        2 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Witch     Ginny    Castle   Charms                        6 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Witch     Hermione Castle   Potions                       9 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Witch     Ginny    Castle   Potions                       5 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Wizard    Harry    Castle   <span style="color: #BB0000;">NA</span>                            7 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Wizard    Ron      Castle   <span style="color: #BB0000;">NA</span>                            2 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Wizard    Harry    Castle   Charms                        0 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Wizard    Ron      Castle   Charms                        0 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Wizard    Harry    Castle   Potions                       7 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Wizard    Ron      Castle   Potions                       2 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Witch     Hermione Grounds  <span style="color: #BB0000;">NA</span>                            7 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Witch     Ginny    Grounds  <span style="color: #BB0000;">NA</span>                            8 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Witch     Hermione Grounds  Herbology                     5 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Witch     Ginny    Grounds  Herbology                     1 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> Witch     Hermione Grounds  Care of Magical Creatures     2 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Witch     Ginny    Grounds  Care of Magical Creatures     7 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Wizard    Harry    Grounds  <span style="color: #BB0000;">NA</span>                           11 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> Wizard    Ron      Grounds  <span style="color: #BB0000;">NA</span>                            3 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span> Wizard    Harry    Grounds  Herbology                     8 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span> Wizard    Ron      Grounds  Herbology                    <span style="color: #BB0000;">NA</span> 10 - really?</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span> Wizard    Harry    Grounds  Care of Magical Creatures     3 <span style="color: #BB0000;">NA</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span> Wizard    Ron      Grounds  Care of Magical Creatures     3 <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>It is up to you now what to do with the ‘total’ values for the castle
and the grounds. If you don’t want to keep them, it’s easy enough to
filter them out using <code>!is.na(subject)</code>. That is done in the
final code listing below.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/unpivotr" class="external-link">unpivotr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">hp_xlsx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/harry-potter.xlsx"</span>, package <span class="op">=</span> <span class="st">"unpivotr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_cells.html" class="external-link">xlsx_cells</a></span><span class="op">(</span><span class="va">hp_xlsx</span>, sheet <span class="op">=</span> <span class="st">"pivoted"</span><span class="op">)</span></span>
<span><span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nacnudus.github.io/tidyxl/reference/xlsx_formats.html" class="external-link">xlsx_formats</a></span><span class="op">(</span><span class="va">hp_xlsx</span><span class="op">)</span></span>
<span></span>
<span><span class="va">indent</span> <span class="op">&lt;-</span> <span class="va">formats</span><span class="op">$</span><span class="va">local</span><span class="op">$</span><span class="va">alignment</span><span class="op">$</span><span class="va">indent</span></span>
<span></span>
<span><span class="va">tidied</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cells</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_blank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up-left"</span>, <span class="st">"dormitory"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"up"</span>, <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead_if</a></span><span class="op">(</span><span class="va">indent</span><span class="op">[</span><span class="va">local_format_id</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>            direction <span class="op">=</span> <span class="st">"left-up"</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/behead.html">behead</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"subject"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">address</span>, <span class="va">dormitory</span>, <span class="va">name</span>, <span class="va">location</span>, <span class="va">subject</span>, mark <span class="op">=</span> <span class="va">numeric</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">dormitory</span>, <span class="va">name</span>, <span class="va">location</span>, <span class="va">subject</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidied</span></span>
<span><span class="co">#&gt; Warning: `...` must be empty in `format.tbl()`</span></span>
<span><span class="co">#&gt; Caused by error in `format_tbl()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `...` must be empty.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Problematic argument:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> options = options</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24 × 6</span></span></span>
<span><span class="co">#&gt;    address dormitory name     location subject                    mark</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> C4      Witch     Ginny    Castle   Charms                        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> C5      Witch     Ginny    Castle   Potions                       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> C3      Witch     Ginny    Castle   <span style="color: #BB0000;">NA</span>                           11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> C8      Witch     Ginny    Grounds  Care of Magical Creatures     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> C7      Witch     Ginny    Grounds  Herbology                     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> C6      Witch     Ginny    Grounds  <span style="color: #BB0000;">NA</span>                            8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> B4      Witch     Hermione Castle   Charms                        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> B5      Witch     Hermione Castle   Potions                       9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> B3      Witch     Hermione Castle   <span style="color: #BB0000;">NA</span>                           11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> B8      Witch     Hermione Grounds  Care of Magical Creatures     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> B7      Witch     Hermione Grounds  Herbology                     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> B6      Witch     Hermione Grounds  <span style="color: #BB0000;">NA</span>                            7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> D4      Wizard    Harry    Castle   Charms                        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> D5      Wizard    Harry    Castle   Potions                       7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> D3      Wizard    Harry    Castle   <span style="color: #BB0000;">NA</span>                            7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> D8      Wizard    Harry    Grounds  Care of Magical Creatures     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> D7      Wizard    Harry    Grounds  Herbology                     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> D6      Wizard    Harry    Grounds  <span style="color: #BB0000;">NA</span>                           11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> E4      Wizard    Ron      Castle   Charms                        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> E5      Wizard    Ron      Castle   Potions                       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span> E3      Wizard    Ron      Castle   <span style="color: #BB0000;">NA</span>                            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span> E8      Wizard    Ron      Grounds  Care of Magical Creatures     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span> E7      Wizard    Ron      Grounds  Herbology                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span> E6      Wizard    Ron      Grounds  <span style="color: #BB0000;">NA</span>                            3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="review">Review<a class="anchor" aria-label="anchor" href="#review"></a>
</h2>
<p>Well done for making it this far. If you have struggled to follow,
that is normal – it means you are learning. Try reading through a second
or third time, and change parts of the code to see what happens.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
